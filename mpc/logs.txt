student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms keyrings create mpc-keys --location=global
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms keys create mpc-key --location=global \
>   --keyring=mpc-keys --purpose=encryption --protection-level=hsm

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ export MPC_PROJECT_ID=$(gcloud config get-value core/project)
Your active configuration is: [cloudshell-5610]
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ echo $MPC_PROJECT_ID 
qwiklabs-gcp-02-1ac615b74db7
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud services enable cloudkms.googleapis.com compute.googleapis.com confidentialcomputing.googleapis.com iamcredentials.googleapis.com artifactregistry.googleapis.com
Operation "operations/acat.p2-1081346364339-59c5fef5-bcb5-4074-aa2d-ea2c4d198332" finished successfully.
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms keys add-iam-policy-binding projects/$MPC_PROJECT_ID/locations/global/keyRings/mpc-keys/cryptoKeys/mpc-key --member="user:$(gcloud config get-value account)" --role='roles/cloudkms.cryptoKeyEncrypter'
Your active configuration is: [cloudshell-5610]
Updated IAM policy for key [mpc-key].
bindings:
- members:
  - user:student-01-db92cdf3a175@qwiklabs.net
  role: roles/cloudkms.cryptoKeyEncrypter
etag: BwZBrYlvXSg=
version: 1
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ echo -n "00000000000000000000000000000000" >> alice-key-share
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ echo -n "00000000000000000000000000000001" >> bob-key-share
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms encrypt \
> --key mpc-key \
> --keyring mpc-keys \
> --location global \
> --plaintext-file alice-key-share \
> --ciphertext-file alice-encrypted-key-share
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms encrypt \
> --key mpc-key \
> --keyring mpc-keys \
> --location global \
> --plaintext-file bob-key-share \
> --ciphertext-file bob-encrypted-key-share
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud storage buckets create gs://$MPC_PROJECT_ID-mpc-encrypted-keys --location=europe-west4
Creating gs://qwiklabs-gcp-02-1ac615b74db7-mpc-encrypted-keys/...
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ ls
alice-encrypted-key-share  alice-key-share  bob-encrypted-key-share  bob-key-share  README-cloudshell.txt

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud storage cp alice-encrypted-key-share gs://$MPC_PROJECT_ID-mpc-encrypted-keys
Copying file://alice-encrypted-key-share to gs://qwiklabs-gcp-02-1ac615b74db7-mpc-encrypted-keys/alice-encrypted-key-share
  Completed files 1/1 | 140.0B/140.0B                                                                                                                         
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud storage cp bob-encrypted-key-share gs://$MPC_PROJECT_ID-mpc-encrypted-keys
Copying file://bob-encrypted-key-share to gs://qwiklabs-gcp-02-1ac615b74db7-mpc-encrypted-keys/bob-encrypted-key-share
  Completed files 1/1 | 139.0B/139.0B                                                                                                                         
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam service-accounts create trusted-mpc-account
Created service account [trusted-mpc-account].
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud kms keys add-iam-policy-binding mpc-key \
> --keyring='mpc-keys' --location='global' \
> --member="serviceAccount:trusted-mpc-account@$MPC_PROJECT_ID.iam.gserviceaccount.com" \
> --role='roles/cloudkms.cryptoKeyDecrypter'
Updated IAM policy for key [mpc-key].
bindings:
- members:
  - serviceAccount:trusted-mpc-account@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  role: roles/cloudkms.cryptoKeyDecrypter
- members:
  - user:student-01-db92cdf3a175@qwiklabs.net
  role: roles/cloudkms.cryptoKeyEncrypter
etag: BwZBraE5JWU=
version: 1
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam workload-identity-pools create trusted-workload-pool --location="global"
Created workload identity pool [trusted-workload-pool].
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam workload-identity-pools providers create-oidc attestation-verifier \
  --location="global" \
  --workload-identity-pool="trusted-workload-pool" \
  --issuer-uri="https://confidentialcomputing.googleapis.com/" \
  --allowed-audiences="https://sts.googleapis.com" \
  --attribute-mapping="google.subject='assertion.sub'" \
  --attribute-condition="assertion.swname == 'CONFIDENTIAL_SPACE' &&
    'STABLE' in assertion.submods.confidential_space.support_attributes &&
    assertion.submods.container.image_reference ==
    'europe-west4-docker.pkg.dev/$MPC_PROJECT_ID/mpc-workloads/initial-workload-container:latest'
    && 'run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com' in
    assertion.google_service_accounts"
Created workload identity pool provider [attestation-verifier].
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam service-accounts add-iam-policy-binding \
trusted-mpc-account@$MPC_PROJECT_ID.iam.gserviceaccount.com \
--role=roles/iam.workloadIdentityUser \
--member="principalSet://iam.googleapis.com/projects/$(gcloud projects describe $MPC_PROJECT_ID --format="value(projectNumber)")/locations/global/workloadIdentityPools/trusted-workload-pool/*"
Updated IAM policy for serviceAccount [trusted-mpc-account@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com].
bindings:
- members:
  - principalSet://iam.googleapis.com/projects/1081346364339/locations/global/workloadIdentityPools/trusted-workload-pool/*
  role: roles/iam.workloadIdentityUser
etag: BwZBrahSmHY=
version: 1
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam service-accounts create run-confidential-vm
Created service account [run-confidential-vm].
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud iam service-accounts add-iam-policy-binding \
  run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com \
  --member="user:$(gcloud config get-value account)" \
  --role='roles/iam.serviceAccountUser'
Your active configuration is: [cloudshell-5610]
Updated IAM policy for serviceAccount [run-confidential-vm@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com].
bindings:
- members:
  - user:student-01-db92cdf3a175@qwiklabs.net
  role: roles/iam.serviceAccountUser
etag: BwZBrarSEk4=
{
version: 1
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud compute instances create-with-container mpc-lab-ethereum-node  \
  --zone=europe-west4-a \
  --tags=http-server \
  --shielded-secure-boot \
  --shielded-vtpm \
  --shielded-integrity-monitoring \
  --container-image=docker.io/trufflesuite/ganache:v7.7.3 \
  --container-arg=--wallet.accounts=\"0x0000000000000000000000000000000000000000000000000000000000000001,0x21E19E0C9BAB2400000\" \
  --container-arg=--port=80 \
  --machine-type=e2-medium
WARNING: The option to deploy a container during VM creation using the container startup agent is deprecated. Use alternative services to run containers on your VMs. Learn more at https://cloud.google.com/compute/docs/containers/migrate-containers.
Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-02-1ac615b74db7/zones/europe-west4-a/instances/mpc-lab-ethereum-node].
WARNING: Some requests generated warnings:
 - You are creating a container VM. The option to deploy a container during VM instance creation that relies on a container startup agent will be discontinued. Use alternative services to run containers on your VMs. Learn more at https://cloud.google.com/compute/docs/containers/migrate-containers

NAME: mpc-lab-ethereum-node
ZONE: europe-west4-a
MACHINE_TYPE: e2-medium
PREEMPTIBLE: 
INTERNAL_IP: 10.164.0.2
EXTERNAL_IP: 34.6.223.222
STATUS: RUNNING
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud storage buckets create gs://$MPC_PROJECT_ID-mpc-results-storage --location=europe-west4
Creating gs://qwiklabs-gcp-02-1ac615b74db7-mpc-results-storage/...
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gsutil iam ch \
  serviceAccount:run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com:objectCreator \
  gs://$MPC_PROJECT_ID-mpc-results-storage
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gsutil iam ch \
  serviceAccount:trusted-mpc-account@$MPC_PROJECT_ID.iam.gserviceaccount.com:objectViewer \
  gs://$MPC_PROJECT_ID-mpc-encrypted-keys
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ mkdir mpc-ethereum-demo
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ cd mpc-ethereum-demo/
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ ls
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi package.json
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi index.js
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi mpc.js
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi kms-decrypt.js
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi credential-config.js
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ vi Dockerfile
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ gcloud artifacts repositories create mpc-workloads \
> --repository-format=docker --location=europe-west4
Create request issued for: [mpc-workloads]
Waiting for operation [projects/qwiklabs-gcp-02-1ac615b74db7/locations/europe-west4/operations/f8af2421-38f7-4d9c-8950-3c6d3b6237dc] to complete...done.                                                                                                                            
Created repository [mpc-workloads].
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ gcloud auth configure-docker europe-west4-docker.pkg.dev
WARNING: Your config file at [/home/student_01_db92cdf3a175/.docker/config.json] contains these credential helper entries:

{
  "credHelpers": {
    "gcr.io": "gcloud",
    "us.gcr.io": "gcloud",
    "eu.gcr.io": "gcloud",
    "asia.gcr.io": "gcloud",
    "staging-k8s.gcr.io": "gcloud",
    "marketplace.gcr.io": "gcloud",
    "africa-south1-docker.pkg.dev": "gcloud",
    "docker.africa-south1.rep.pkg.dev": "gcloud",
    "asia-docker.pkg.dev": "gcloud",
    "asia-east1-docker.pkg.dev": "gcloud",
    "docker.asia-east1.rep.pkg.dev": "gcloud",
    "asia-east2-docker.pkg.dev": "gcloud",
    "docker.asia-east2.rep.pkg.dev": "gcloud",
    "asia-northeast1-docker.pkg.dev": "gcloud",
    "docker.asia-northeast1.rep.pkg.dev": "gcloud",
    "asia-northeast2-docker.pkg.dev": "gcloud",
    "docker.asia-northeast2.rep.pkg.dev": "gcloud",
    "asia-northeast3-docker.pkg.dev": "gcloud",
    "docker.asia-northeast3.rep.pkg.dev": "gcloud",
    "asia-south1-docker.pkg.dev": "gcloud",
    "docker.asia-south1.rep.pkg.dev": "gcloud",
    "asia-south2-docker.pkg.dev": "gcloud",
    "docker.asia-south2.rep.pkg.dev": "gcloud",
    "asia-southeast1-docker.pkg.dev": "gcloud",
    "docker.asia-southeast1.rep.pkg.dev": "gcloud",
    "asia-southeast2-docker.pkg.dev": "gcloud",
    "docker.asia-southeast2.rep.pkg.dev": "gcloud",
    "australia-southeast1-docker.pkg.dev": "gcloud",
    "docker.australia-southeast1.rep.pkg.dev": "gcloud",
    "australia-southeast2-docker.pkg.dev": "gcloud",
    "docker.australia-southeast2.rep.pkg.dev": "gcloud",
    "europe-docker.pkg.dev": "gcloud",
    "europe-central2-docker.pkg.dev": "gcloud",
    "docker.europe-central2.rep.pkg.dev": "gcloud",
    "europe-north1-docker.pkg.dev": "gcloud",
    "docker.europe-north1.rep.pkg.dev": "gcloud",
    "europe-north2-docker.pkg.dev": "gcloud",
    "europe-southwest1-docker.pkg.dev": "gcloud",
    "docker.europe-southwest1.rep.pkg.dev": "gcloud",
    "europe-west1-docker.pkg.dev": "gcloud",
    "docker.europe-west1.rep.pkg.dev": "gcloud",
    "europe-west10-docker.pkg.dev": "gcloud",
    "docker.europe-west10.rep.pkg.dev": "gcloud",
    "europe-west12-docker.pkg.dev": "gcloud",
    "docker.europe-west12.rep.pkg.dev": "gcloud",
    "europe-west2-docker.pkg.dev": "gcloud",
    "docker.europe-west2.rep.pkg.dev": "gcloud",
    "europe-west3-docker.pkg.dev": "gcloud",
    "docker.europe-west3.rep.pkg.dev": "gcloud",
    "europe-west4-docker.pkg.dev": "gcloud",
    "docker.europe-west4.rep.pkg.dev": "gcloud",
    "europe-west6-docker.pkg.dev": "gcloud",
    "docker.europe-west6.rep.pkg.dev": "gcloud",
    "europe-west8-docker.pkg.dev": "gcloud",
    "docker.europe-west8.rep.pkg.dev": "gcloud",
    "europe-west9-docker.pkg.dev": "gcloud",
    "docker.europe-west9.rep.pkg.dev": "gcloud",
    "me-central1-docker.pkg.dev": "gcloud",
    "docker.me-central1.rep.pkg.dev": "gcloud",
    "me-central2-docker.pkg.dev": "gcloud",
    "docker.me-central2.rep.pkg.dev": "gcloud",
    "me-west1-docker.pkg.dev": "gcloud",
    "docker.me-west1.rep.pkg.dev": "gcloud",
    "northamerica-northeast1-docker.pkg.dev": "gcloud",
    "docker.northamerica-northeast1.rep.pkg.dev": "gcloud",
    "northamerica-northeast2-docker.pkg.dev": "gcloud",
    "docker.northamerica-northeast2.rep.pkg.dev": "gcloud",
    "northamerica-south1-docker.pkg.dev": "gcloud",
    "southamerica-east1-docker.pkg.dev": "gcloud",
    "docker.southamerica-east1.rep.pkg.dev": "gcloud",
    "southamerica-west1-docker.pkg.dev": "gcloud",
    "docker.southamerica-west1.rep.pkg.dev": "gcloud",
    "us-docker.pkg.dev": "gcloud",
    "us-central1-docker.pkg.dev": "gcloud",
    "docker.us-central1.rep.pkg.dev": "gcloud",
    "us-central2-docker.pkg.dev": "gcloud",
    "docker.us-central2.rep.pkg.dev": "gcloud",
    "us-east1-docker.pkg.dev": "gcloud",
    "docker.us-east1.rep.pkg.dev": "gcloud",
    "us-east4-docker.pkg.dev": "gcloud",
    "docker.us-east4.rep.pkg.dev": "gcloud",
    "us-east5-docker.pkg.dev": "gcloud",
    "docker.us-east5.rep.pkg.dev": "gcloud",
    "us-east7-docker.pkg.dev": "gcloud",
    "docker.us-east7.rep.pkg.dev": "gcloud",
    "us-south1-docker.pkg.dev": "gcloud",
    "docker.us-south1.rep.pkg.dev": "gcloud",
    "us-west1-docker.pkg.dev": "gcloud",
    "docker.us-west1.rep.pkg.dev": "gcloud",
    "us-west2-docker.pkg.dev": "gcloud",
    "docker.us-west2.rep.pkg.dev": "gcloud",
    "us-west3-docker.pkg.dev": "gcloud",
    "docker.us-west3.rep.pkg.dev": "gcloud",
    "us-west4-docker.pkg.dev": "gcloud",
    "docker.us-west4.rep.pkg.dev": "gcloud",
    "us-west8-docker.pkg.dev": "gcloud"
  }
}
Adding credentials for: europe-west4-docker.pkg.dev
gcloud credential helpers already registered correctly.

student_01_db92cdf3a175@cloudshell:~/mpc-ethereum-demo (qwiklabs-gcp-02-1ac615b74db7)$ cd ..
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ docker build -t europe-west4-docker.pkg.dev/$MPC_PROJECT_ID/mpc-workloads/initial-workload-container:latest mpc-ethereum-demo
[+] Building 54.5s (10/10) FINISHED                                                                                         docker:default
 => [internal] load build definition from Dockerfile                                                                                  0.0s
 => => transferring dockerfile: 411B                                                                                                  0.0s
 => [internal] load metadata for docker.io/library/node:16.18.0                                                                       2.7s
 => [internal] load .dockerignore                                                                                                     0.0s
 => => transferring context: 2B                                                                                                       0.0s
 => [internal] load build context                                                                                                     0.0s
 => => transferring context: 6.18kB                                                                                                   0.0s
 => [1/5] FROM docker.io/library/node:16.18.0@sha256:3547c98a330a08fb9dbb8b04ac4430f6d21133cb79f21f6cf8283184f523ff83                24.7s
 => => resolve docker.io/library/node:16.18.0@sha256:3547c98a330a08fb9dbb8b04ac4430f6d21133cb79f21f6cf8283184f523ff83                 0.0s
 => => sha256:3547c98a330a08fb9dbb8b04ac4430f6d21133cb79f21f6cf8283184f523ff83 776B / 776B                                            0.0s
 => => sha256:868adae7c567610f2244bfde0bfb41d7313b683000994bbfaa0597d5a96c3319 2.21kB / 2.21kB                                        0.0s
 => => sha256:933c2d54737a29ade863f4303ba0a185a65b8d9eb31a050b74777d81583f36e3 7.52kB / 7.52kB                                        0.0s
 => => sha256:fd31ec14dccdcda8f2472547f1a94ef0a23b8dabb764cd7b1d48aeee0afea7c8 50.45MB / 50.45MB                                      0.9s
 => => sha256:1b6422bfa32650e77d346bbb40c6b2a0dc34c863e10cfb1a117e8da9796694cd 7.86MB / 7.86MB                                        0.5s
 => => sha256:335cbfc794fe106b207828e6c9d76fb72aa4631aad91b744e23442082275b8af 10.00MB / 10.00MB                                      0.6s
 => => sha256:2a348ba61fbef6dec66be0354c013afc02f0bba15b891b9625ac45bb007e9726 51.84MB / 51.84MB                                      1.4s
 => => sha256:f1ac0452e7a7ce5a9781502e1bca3360740aa17c776748eb301c26ca8f5b294a 192.51MB / 192.51MB                                    3.7s
 => => sha256:7a53749a183a965085e17a671ec23dd3531d7db1f33675510464db37004814f3 4.20kB / 4.20kB                                        1.1s
 => => extracting sha256:fd31ec14dccdcda8f2472547f1a94ef0a23b8dabb764cd7b1d48aeee0afea7c8                                             4.4s
 => => sha256:575ea4f7758d750d033a124efb54a9286b2473eb533511e1e3c59127bc5b6238 34.98MB / 34.98MB                                      1.9s
 => => sha256:0c712a4c97e63f7bb32eaafd6d65a3bebfa5c1afd9da5bfcffe074cf3931a471 2.28MB / 2.28MB                                        1.7s
 => => sha256:7521b80efb59c87ab87d986599062c9a62c34961c0fa8c2c10c7e93ecb9ca84e 451B / 451B                                            2.0s
 => => extracting sha256:1b6422bfa32650e77d346bbb40c6b2a0dc34c863e10cfb1a117e8da9796694cd                                             0.4s
 => => extracting sha256:335cbfc794fe106b207828e6c9d76fb72aa4631aad91b744e23442082275b8af                                             0.3s
 => => extracting sha256:2a348ba61fbef6dec66be0354c013afc02f0bba15b891b9625ac45bb007e9726                                             3.6s
 => => extracting sha256:f1ac0452e7a7ce5a9781502e1bca3360740aa17c776748eb301c26ca8f5b294a                                            10.6s
 => => extracting sha256:7a53749a183a965085e17a671ec23dd3531d7db1f33675510464db37004814f3                                             0.0s
 => => extracting sha256:575ea4f7758d750d033a124efb54a9286b2473eb533511e1e3c59127bc5b6238                                             2.1s
 => => extracting sha256:0c712a4c97e63f7bb32eaafd6d65a3bebfa5c1afd9da5bfcffe074cf3931a471                                             0.1s
 => => extracting sha256:7521b80efb59c87ab87d986599062c9a62c34961c0fa8c2c10c7e93ecb9ca84e                                             0.0s
 => [2/5] WORKDIR /app                                                                                                                3.0s
 => [3/5] COPY [package.json, package-lock.json*, ./]                                                                                 0.0s
 => [4/5] RUN npm install --production                                                                                               21.6s
 => [5/5] COPY . .                                                                                                                    0.0s 
 => exporting to image                                                                                                                2.2s 
 => => exporting layers                                                                                                               2.2s 
 => => writing image sha256:67709cfbfaaf17af26eeaf425f71f66012b14738f5010928aee7346db4aa869d                                          0.0s 
 => => naming to europe-west4-docker.pkg.dev/qwiklabs-gcp-02-1ac615b74db7/mpc-workloads/initial-workload-container:latest             0.0s 

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ docker push europe-west4-docker.pkg.dev/$MPC_PROJECT_ID/mpc-workloads/
initial-workload-container:latest 
The push refers to repository [europe-west4-docker.pkg.dev/qwiklabs-gcp-02-1ac615b74db7/mpc-workloads/initial-workload-container]
9ce2d23a8a8b: Pushed 
aae01d8a5565: Pushed 
81610fbbbaa4: Pushed 
03b831420dea: Pushed 
bcf883189f25: Pushed 
cf3ca6f16088: Pushed 
7b43c3651de7: Pushed 
ba74cf904ea6: Pushed 
36d4a190a4f6: Pushed 
9cfc4aa8768a: Pushed 
ada8cfae898c: Pushed 
7a0f5beec8b3: Pushed 
f0a87eb98d2a: Pushed 
latest: digest: sha256:dfe0988a7d1be3d4a851136f1f70863418f90aacf1d1aa312974d2ac9fb1865e size: 3048

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud artifacts repositories add-iam-policy-binding mpc-workloads \
    --location=europe-west4 \
    --member=serviceAccount:run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com \
    --role=roles/artifactregistry.reader
Updated IAM policy for repository [mpc-workloads].
bindings:
- members:
  - serviceAccount:run-confidential-vm@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  role: roles/artifactregistry.reader
etag: BwZBrdGEJgk=
version: 1

student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud projects add-iam-policy-binding $MPC_PROJECT_ID \
--member=serviceAccount:run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com \
--role=roles/confidentialcomputing.workloadUser
Updated IAM policy for project [qwiklabs-gcp-02-1ac615b74db7].
bindings:
- members:
  - serviceAccount:service-1081346364339@gcp-sa-artifactregistry.iam.gserviceaccount.com
  role: roles/artifactregistry.serviceAgent
- members:
  - serviceAccount:qwiklabs-gcp-02-1ac615b74db7@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  role: roles/bigquery.admin
- members:
  - serviceAccount:1081346364339@cloudbuild.gserviceaccount.com
  role: roles/cloudbuild.builds.builder
- members:
  - serviceAccount:service-1081346364339@gcp-sa-cloudbuild.iam.gserviceaccount.com
  role: roles/cloudbuild.serviceAgent
- members:
  - serviceAccount:service-1081346364339@compute-system.iam.gserviceaccount.com
  role: roles/compute.serviceAgent
- members:
  - serviceAccount:run-confidential-vm@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  role: roles/confidentialcomputing.workloadUser
- members:
  - serviceAccount:service-1081346364339@container-engine-robot.iam.gserviceaccount.com
  role: roles/container.serviceAgent
- members:
  - serviceAccount:1081346364339-compute@developer.gserviceaccount.com
  - serviceAccount:1081346364339@cloudservices.gserviceaccount.com
  role: roles/editor
- members:
  - serviceAccount:admiral@qwiklabs-services-prod.iam.gserviceaccount.com
  - serviceAccount:qwiklabs-gcp-02-1ac615b74db7@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  - user:student-01-db92cdf3a175@qwiklabs.net
  role: roles/owner
- members:
  - serviceAccount:qwiklabs-gcp-02-1ac615b74db7@qwiklabs-gcp-02-1ac615b74db7.iam.gserviceaccount.com
  role: roles/storage.admin
- members:
  - user:student-01-db92cdf3a175@qwiklabs.net
  role: roles/viewer
etag: BwZBrdHNJhA=
version: 1
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ 
student_01_db92cdf3a175@cloudshell:~ (qwiklabs-gcp-02-1ac615b74db7)$ gcloud compute instances create mpc-cvm --confidential-compute \
  --shielded-secure-boot \
  --maintenance-policy=TERMINATE --scopes=cloud-platform  --zone=europe-west4-a \
  --image-project=confidential-space-images \
  --image-family=confidential-space \
  --service-account=run-confidential-vm@$MPC_PROJECT_ID.iam.gserviceaccount.com \
  --metadata ^~^tee-image-reference=europe-west4-docker.pkg.dev/$MPC_PROJECT_ID/mpc-workloads/initial-workload-container:latest~tee-restart-policy=Never~tee-env-NODE_URL=$(gcloud compute instances describe mpc-lab-ethereum-node --format='get(networkInterfaces[0].networkIP)' --zone=europe-west4-a)~tee-env-RESULTS_BUCKET=$MPC_PROJECT_ID-mpc-results-storage~tee-env-KEY_BUCKET=$MPC_PROJECT_ID-mpc-encrypted-keys~tee-env-MPC_PROJECT_ID=$MPC_PROJECT_ID~tee-env-MPC_PROJECT_NUMBER=$(gcloud projects describe $MPC_PROJECT_ID --format="value(projectNumber)")
WARNING: The --confidential-compute flag will soon be deprecated. Please use `--confidential-compute-type=SEV` instead
Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-02-1ac615b74db7/zones/europe-west4-a/instances/mpc-cvm].
NAME: mpc-cvm
ZONE: europe-west4-a
MACHINE_TYPE: n2d-standard-2
PREEMPTIBLE: 
INTERNAL_IP: 10.164.0.3
EXTERNAL_IP: 34.6.62.152
STATUS: RUNNING
student_01_db92cdf3a175@cloudshell:~ (qw


student-01-db92cdf3a175@mpc-lab-ethereum-node ~ $ sudo docker ps
CONTAINER ID   IMAGE                         COMMAND                  CREATED          STATUS          PORTS     NAMES
d79dde0c0c5f   trufflesuite/ganache:v7.7.3   "node /app/dist/node…"   14 minutes ago   Up 14 minutes             klt-mpc-lab-ethereum-node-pbga
student-01-db92cdf3a175@mpc-lab-ethereum-node ~ $ 
student-01-db92cdf3a175@mpc-lab-ethereum-node ~ $ 
student-01-db92cdf3a175@mpc-lab-ethereum-node ~ $ sudo docker logs d79dde0c0c5f
ganache v7.7.3 (@ganache/cli: 0.8.2, @ganache/core: 0.8.2)
Starting RPC server
(node:1) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.
(Use `node --trace-deprecation ...` to show where the warning was created)

Available Accounts
==================
(0) 0x7E5F4552091A69125d5DfCb7b8C2659029395Bdf (10000 ETH)

Private Keys
==================
(0) 0x0000000000000000000000000000000000000000000000000000000000000001

Default Gas Price
==================
2000000000

BlockGas Limit
==================
30000000

Call Gas Limit
==================
50000000

Chain Id
==================
1337

RPC Listening on 0.0.0.0:80
eth_chainId
eth_chainId
eth_blockNumber
eth_chainId
eth_sendRawTransaction

  Transaction: 0x92c8c4abdde5f6b0411bb8041829b7fe020381276c7192c61c8895757fc20452
  Gas usage: 21000
  Block number: 1
  Block time: Tue Oct 21 2025 16:40:08 GMT+0000 (Coordinated Universal Time)
